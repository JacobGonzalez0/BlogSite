<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <!-- Head imports -->
    <head th:replace=" fragments/head :: head('Create Post')">

    <!-- Theme included stylesheets -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

</head>
<body>
    <nav th:replace="fragments/navbar :: navBar">

    </nav>

    <div th:replace="fragments/alerts :: alerts">

    </div>

    <div class="container-fluid container-lg p-0 px-md-2">
        <div class="row w-100">
            <div class="col col-md-8">

                <form class="mx-auto my-3 col col-md-8 row needs-validation form-control" action="/post/create" method="post" novalidate>
                    <div class="p-4">
    
                        <label class="visually-hidden" title="title" aria-labelledby="title">Title</label>
                        <input class="form-control col my-2" type="text" name="title" placeholder="Title" />
        
                        <label class="visually-hidden" title="content" aria-labelledby="content"/>Content</label>
                        <div class="col">
                            <textarea name="content" id="editor" cols="30" rows="10"></textarea>
                        </div>
                        
                        <label class="visually-hidden" title="userid" aria-labelledby="userid"/>UserID</label>
                        <input class="form-control col my-2" type="text" name="userid" placeholder="UserID"/>

                        <input class="btn btn-primary col my-2" type="submit" />
                    </div>
    
                </form>
                <!-- Form ends -->
            </div>
            
        </div>
    </div>

    <footer th:replace="fragments/footer :: footer">

    </footer>
    
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.7.1/tinymce.min.js" integrity="sha512-RnlQJaTEHoOCt5dUTV0Oi0vOBMI9PjCU7m+VHoJ4xmhuUNcwnB5Iox1es+skLril1C3gHTLbeRepHs1RpSCLoQ==" crossorigin="anonymous"></script>
<script> 
     tinymce.init({
        selector: '#editor',
        plugins: 'link lists media image code',
        mobile: {
            menubar: true
        },
        toolbar: 'alignleft aligncenter alignright alignjustify | formatselect | bullist numlist | outdent indent | link image code',
        images_upload_handler: (blobInfo, success, failure)=>{
            var xhr, formData;
        
            xhr = new XMLHttpRequest();
            xhr.withCredentials = false;
            xhr.open('POST', 'http://localhost:8080/upload/image');

            xhr.onload = function () {
                var json;

                if (xhr.status != 200) {
                    failure('HTTP Error: ' + xhr.status);
                    return;
                }

                json = xhr.responseText;
                success(json);
            };

            formData = new FormData();
            formData.append('file', blobInfo.blob(), blobInfo.filename());

            xhr.send(formData);
        },
        
        /* enable title field in the Image dialog*/
        image_title: true,
        
        /* enable automatic uploads of images represented by blob or data URIs*/
        automatic_uploads: true,
                                
        /*Here we add custom filepicker only to Image dialog*/
        file_picker_types: 'image',
        
        /* and here's our custom image picker*/
        file_picker_callback: function (cb, value, meta) {
            var input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'image/*');
    
            input.onchange = function () {
                var file = this.files[0];                    
                var reader = new FileReader();
                
                reader.onload = function () {
                    /*
                    Note: Now we need to register the blob in TinyMCEs image blob
                    registry. In the next release this part hopefully won't be
                    necessary, as we are looking to handle it internally.
                    */
                    var id = 'blobid' + (new Date()).getTime();
                    var blobCache =  tinymce.activeEditor.editorUpload.blobCache;
                    var base64 = reader.result.split(',')[1];
                    
                    var blobInfo = blobCache.create(id, file, base64);                                    
                    blobCache.add(blobInfo);
    
                    /* call the callback and populate the Title field with the file name */
                    cb(blobInfo.blobUri(), { title: file.name });
                };
            
                reader.readAsDataURL(file);
            };
    
            input.click();
        }              
    });
</script>

</html>